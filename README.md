# clndr
北京大学中文系教授沈炯先生用BASIC语言编写的《万年历》程序，完成的时间，据程序注释，是在1996年7月20日，发布到互联网上，据下载到的压缩包中的文件日期，可能是在2002年的时候。这期间不排除沈先生对程序有过少量改动，也许有对当时新的中国历史断代成果的加入。虽然发布到网上的时候使用了当时个人电脑普遍使用的DOS系统自带的QBASIC环境来运行，但并没有使用QBASIC已经支持的结构化编程方式，加上DOS环境对单个程序段使用64kb内存的限制，沈先生不得不在程序中使用了大量GOSUB和GOTO语句重用BASIC的一些基本命令来减少编译后代码的长度，如改变输出字符颜色的COLOR语句、改变输出位置的LOCALE语句、屏幕输出的PRINT语句，再加上处理键盘按键使用的几个ON...GOTO语句，使得整个程序的结构显得零乱，有几分汇编语言的感觉（沈先生也是会用汇编语言的）。这样写的好处是，程序可以兼容早期不支持结构化的BASIC环境，如GWBASIC，但是这样的代码难以维护，也难以移植到其他语言。而随着Windows的兴起，特别是Windows XP系统成为主流之后，需要中文DOS命令行环境运行的这个程序，想运行起来变得越来越费事了。
在网上认识沈炯先生大概是2006年在北大中文论坛（www.pkucn.com ，现在已经关闭了，因此当时关于这个《万年历》程序的讨论我也都找不到了）。当时的我在了解历法知识，也在想用当时学过的几种语言的一种或几种实现万年历程序。在网上搜索到沈炯先生的这个《万年历》程序，也就顺便找到了作者。BASIC语言和QBASIC是我非常熟悉的计算机语言，加上当时20多岁思维还算迅捷，对于结构化沈先生的《万年历》很有信心。而当时发现了开源的FreeBASIC语言，可以几乎全部兼容QBASIC语言，而在各个平台上编译后运行，也是想结构化这个BASIC程序而不是用其他语言重写的重要原因。记得当时说过“请沈先生放心，一定会完成这个程序的结构化”的话，但却到现在一直没能完成——受限于个人能力，也受限于时间和精力。
《万年历》程序本身并没有进行天文学方面的计算，而是通过查表实现农历、伊斯兰历、儒略历等历法和公历的对应，而其中涉及的“古六历”很可能只是传说，对应到公历大概也没什么意义。可以查看的日期范围虽然是-9999到9999年，但公元前的历法都只是按现代历法的向前推演，几千年后的历法更需要和之后的天文观测相符合也不会很准确。对于在找使用《万年历》查询历法相关信息的使用者，或许《日梭万年历》《寿星天文历》才是更好的选择。
沈先生已于2015年3月12日逝世，但这程序的结构化我还是想要完成的。算是对沈老的纪念，也算是对自己经历过的日子，包括学习使用BASIC和QBASIC的日子和学习历法知识的日子，的一种纪念吧。因为“2019-nCoV”而延长了的假期的第一天，想起来之前未完成的一些事情，因此先把这个项目发布到这来，以后如有空闲会尽量完成。
